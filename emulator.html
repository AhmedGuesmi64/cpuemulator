<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CP Emulator — Runtime</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="css/theme.css">
</head>
<body>
  <div class="app">
    <nav class="topnav card">
        <div class="topnav-left">
          <a href="index.html" class="topnav-link">Home</a>
          <a href="emulator.html" class="topnav-link">Emulator</a>
          <a href="docs/README.html" class="topnav-link">Docs</a>
        </div>
        <div class="topnav-right">
          <button class="btn secondary" id="nav-back">Back</button>
          <button class="btn secondary" id="nav-forward">Forward</button>
        </div>
      </nav>
      
    <div class="header">
      <div class="brand">CP</div>
      <div>
        <div class="title">CP Emulator — Runtime</div>
        <div class="subtitle">Step / Run / Animate a tiny CPU</div>
      </div>
    </div>

    <div class="editor row">
      <!-- LEFT: Controls -->
      <div class="pane">
        <div class="top-controls card">
          <div>
            <strong>Assembler (optional)</strong>
            <textarea id="assembler-in" class="input" rows="6" placeholder="LD [00], r0&#10;LD [01], r1..."></textarea>
            <div style="margin-top:8px">
              <button class="btn" onclick="assemble()">Assemble → Program Memory</button>
              <button class="btn secondary" onclick="clearSource()">Clear</button>
              <button class="btn secondary" onclick="loadSample()">Load Example</button>
            </div>
            <input id="file-input" type="file" accept=".asm,.s,.txt,.hex" style="display:none" />
            <button class="btn secondary" onclick="document.getElementById('file-input').click()">Import .asm / .hex</button>

            <!-- Drag-and-drop target (place near the top of the emulator page) -->
            <div id="drop-target" class="card" style="padding:10px;margin-top:8px;text-align:center;color:var(--muted-text)">
              Drag .asm or .hex files here to load them into the emulator
            </div>
          </div>

          <div>
            <strong>Machine Code (hex)</strong>
            <textarea id="machine-in" class="input" rows="6" placeholder="00 01 A1 12 10 C0"></textarea>
            <div style="margin-top:8px">
              <button class="btn secondary" onclick="loadMachineCode()">Load → Program Memory</button>
            </div>
          </div>
        </div>

        <div class="sep"></div>

        <div class="card notes-highlight" tabindex="0">
          <strong>Notes</strong>
          <div class="code" contenteditable="true" id="notes">Use Step to execute single instruction; Animate to watch automatic execution.</div>
          <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
            <button class="btn" id="notes-save-btn">Save Notes</button>
            <button class="btn secondary" id="notes-export-btn">Export .txt</button>
            <input id="notes-file-input" type="file" accept=".txt" style="display:none"/>
            <button class="btn secondary" id="notes-import-btn">Import .txt</button>
            <label class="note" style="margin-left:8px">Autosave: <span id="notes-autosave-status">On</span></label>
          </div>
          
        </div>
      </div>

      <!-- MIDDLE: Program / Data mem -->
      <div class="pane card emulator-pane">
        <div style="margin-bottom:8px">
          <strong>Program Memory</strong>
          <table id="prog-mem-table" class="table" style="margin-top:8px"></table>
        </div>
        <div style="margin-top:12px">
          <strong>Data Memory</strong>
          <table id="data-mem-table" class="table" style="margin-top:8px"></table>
        </div>
      </div>

      <!-- RIGHT: Registers & controls -->
      <div class="pane" style="max-width:320px">
        <div class="card">
          <div><strong>Registers</strong></div>
          <div id="regs" class="regs" style="margin:8px 0">r0:00 | r1:00 | r2:00 | r3:00</div>
          <div class="kv"><strong>PC:</strong><div id="pc" style="min-width:48px">00</div><strong style="margin-left:8px">Flags:</strong><div id="flags" class="note" style="min-width:90px;margin-left:6px">Z:0 C:0</div></div>
        </div>

        <div style="height:12px"></div>

        <div class="card">
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn" onclick="step()">Step</button>
            <button class="btn" onclick="run()">Run</button>
            <button class="btn" onclick="animateExec()">Animate</button>
            <button class="btn secondary" onclick="reset()">Reset</button>
            <button class="btn secondary" onclick="stop()">Stop</button>
          </div>
          <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
            <label style="font-size:13px;color:var(--muted-text)">Anim delay (ms):</label>
            <input id="anim-delay" type="number" class="input" value="400" style="width:84px;padding:8px"/>
          </div>
        </div>

        <div style="height:12px"></div>

        <div class="card">
          <strong>Execution Trace</strong>
          <div id="trace" style="margin-top:8px; max-height:200px; overflow:auto; font-family:var(--mono); font-size:13px; color:var(--muted-text)"></div>
        </div>
      </div>
    </div>
  </div>
  <script src="js/navigationMenuScript.js"></script>
  <script src="js/emulatorLogic.js"></script>
</body>
</html>
